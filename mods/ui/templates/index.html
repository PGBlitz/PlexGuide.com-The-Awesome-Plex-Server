<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlexGuide UI: Docker Compose</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body style="background-color: black; color: white;">
    <h1>PlexGuide UI: Docker Compose</h1>
    <hr>

    <!-- Application Selection -->
    <label for="app-select">Select Application:</label>
    <select id="app-select">
        <option value="">Make a Selection</option>
        {% for folder in folders %}
        <option value="{{ folder }}">{{ folder }}</option>
        {% endfor %}
    </select>

    <label for="docker-status">Docker Status:</label>
    <span id="docker-status"></span>

    <!-- Textarea to display and edit docker-compose.yml -->
    <div>
        <textarea id="yml-content" rows="20" cols="80" placeholder="YML content will appear here..." disabled></textarea>
    </div>

    <!-- Action buttons -->
    <button id="save-btn" style="background-color: green; color: white;">Save</button>
    <button id="deploy-btn" style="background-color: darkgoldenrod; color: white;">Deploy</button>
    <button id="kill-btn" style="background-color: red; color: white;">Kill</button>

    <!-- Status update box -->
    <div id="status-box" style="margin-top: 10px; background-color: black; color: white; padding: 10px; border: 1px solid white;"></div>

    <script>
        // Load docker-compose.yml content when an app is selected
        $('#app-select').on('change', function () {
            var selectedApp = $(this).val();

            if (selectedApp) {
                $.post('/load_yml', { folder: selectedApp }, function (data) {
                    $('#yml-content').val(data).prop('disabled', false);
                    $('#docker-status').text("Checking status...");
                    // You can add logic here to check Docker status and update the Docker status
                });
            } else {
                $('#yml-content').val("").prop('disabled', true);
                $('#docker-status').text("");
            }
        });

        // Save changes to the docker-compose.yml file
        $('#save-btn').on('click', function () {
            var selectedApp = $('#app-select').val();
            var ymlContent = $('#yml-content').val();

            if (selectedApp && ymlContent) {
                $.post('/save_yml', { folder: selectedApp, yml_content: ymlContent }, function (response) {
                    $('#status-box').text("* YML file saved successfully at " + new Date().toLocaleTimeString());
                }).fail(function () {
                    $('#status-box').text("* Error saving YML file");
                });
            } else {
                alert("Please select an application and load the YML file.");
            }
        });

        // Deploy the docker-compose.yml file
        $('#deploy-btn').on('click', function () {
            var selectedApp = $('#app-select').val();

            if (selectedApp) {
                $('#status-box').text("* Deploying the application at " + new Date().toLocaleTimeString());
                // Call your deploy function here (e.g., a Docker command via Flask)
            } else {
                alert("Please select an application to deploy.");
            }
        });

        // Kill the running Docker container
        $('#kill-btn').on('click', function () {
            var selectedApp = $('#app-select').val();

            if (selectedApp) {
                $('#status-box').text("* Killing the application at " + new Date().toLocaleTimeString());
                // Call your kill function here (e.g., a Docker stop command via Flask)
            } else {
                alert("Please select an application to kill.");
            }
        });
    </script>
</body>
</html>
